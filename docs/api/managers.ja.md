# マネージャーAPIリファレンス

Argodeのモジュール式アーキテクチャは、ビジュアルノベルプロジェクト内の特定のドメインをそれぞれ処理する、専門化されたマネージャーのコレクションに基づいて構築されています。これらのマネージャーは、中央の`ArgodeSystem`シングルトンのプロパティとしてアクセスでき、フレームワークの機能との整理された効率的な相互作用を可能にします。

このドキュメントでは、主要なマネージャーとその役割の概要を説明します。個々のマネージャーの詳細なAPI仕様については、それぞれのドキュメント（利用可能な場合）またはソースコードを参照してください。

## マネージャーへのアクセス

すべてのマネージャーは`ArgodeSystem`の子ノードであり、そのプロパティを介してアクセスできます。

```gdscript
var argode_system = get_node("/root/ArgodeSystem") # またはグローバルに設定されている場合はArgodeSystem
var ui_manager = argode_system.UIManager
var variable_manager = argode_system.VariableManager
# ...その他のマネージャーも同様
```

## コアマネージャーの概要

### `UIManager`

`UIManager`は、ユーザーインターフェースのすべての側面を担当します。UIシーン（`.tscn`ファイル）のロード、表示、解放を処理し、ダイアログボックス、選択メニュー、その他のインタラクティブなUIコンポーネントなどの要素を管理します。`LayerManager`と密接に連携して、UI要素が画面に正しく配置されるようにします。

**主な責任:**
*   ダイアログとキャラクター名の表示。
*   選択メニューの表示とユーザー選択の処理。
*   カスタムUIシーン（例：インベントリ、設定画面）のロードと管理。
*   メッセージウィンドウの可視性と状態の制御。

### `VariableManager`

`VariableManager`は、ゲーム関連のすべての変数とデータの中央リポジトリです。プリミティブ型、配列、辞書などのさまざまなデータ型をサポートし、複雑で動的な物語の状態を可能にします。`.rgd`スクリプトとGDScriptから直接変数と条件を設定、取得、評価するためのメソッドを提供します。

**主な責任:**
*   グローバル変数とローカル変数の保存と管理。
*   条件式（`if`ステートメント）の評価。
*   キャラクター定義とその関連データの処理。
*   配列と辞書のデータ構造の管理。

### `CharacterManager`

`CharacterManager`は、ビジュアルノベル内のキャラクターの管理に特化しています。キャラクターの定義（名前、表示名、色）、表情、画面上での視覚的な表示を処理し、物語全体で一貫した表現を保証します。`LayerManager`と連携して、指定されたレイヤーにキャラクターを表示します。

**主な責任:**
*   キャラクター定義の登録と取得。
*   指定された表情と位置でキャラクターを表示および非表示にする。
*   キャラクター固有の視覚効果の管理。

### `LayerManager`

`LayerManager`は、Godotプロジェクト内の異なる`CanvasLayer`ノード間で視覚要素を整理および表示するための柔軟なシステムを提供します。厳密なシーン構造を強制するのではなく、レイヤーの「役割」（例：「背景」、「キャラクター」、「UI」、「エフェクト」）を定義し、それらを実際の`CanvasLayer`ノードにマッピングできます。

**主な責任:**
*   レイヤーの役割を`CanvasLayer`ノードにマッピングする。
*   トランジションを伴う背景の変更を処理する。
*   キャラクターとUI要素をそれぞれのレイヤーに配置する。
*   視覚的な深度を制御するための構造化された方法を提供する。

### `CustomCommandHandler`

`CustomCommandHandler`は、Argodeの強力な拡張性へのゲートウェイです。カスタムGDScriptまたはC#ロジックを`.rgd`スクリプトに直接統合できます。`ScriptPlayer`が認識しないコマンドを検出すると、`CustomCommandHandler`がシグナルを発行し、定義したカスタム機能を実行できます。

**主な責任:**
*   カスタムコマンドの登録（`BaseCustomCommand`インスタンスまたは`Callable`を介して）。
*   `.rgd`スクリプトからのカスタムコマンド呼び出しをGDScript関数にディスパッチする。n*   同期および非同期のカスタムコマンド実行を管理する。

### `LabelRegistry`

`LabelRegistry`は、`.rgd`スクリプトファイルをスキャンし、定義されたすべての`label`のインデックスを構築する役割を担っています。これにより、効率的なクロスファイルジャンプと呼び出しが可能になり、複雑な分岐する物語とモジュール式のスクリプト編成をサポートします。

**主な責任:**
*   指定されたディレクトリ内の`.rgd`ファイルをスキャンする。
*   `.rgd`ファイルを解析してラベルを識別および登録する。
*   複数のスクリプトファイルにわたるラベルのルックアップ機能を提供する。

### `TransitionPlayer`

`TransitionPlayer`は、シーン、キャラクター、その他の視覚要素間の視覚的なトランジションを管理します。さまざまなトランジション効果（例：フェード、ディゾルブ、カスタムシェーダー）を適用するための一元化されたシステムを提供し、ビジュアルノベルの視覚的な流れを強化します。

**主な責任:**
*   定義済みのトランジション効果を実行する。
*   背景の変更、キャラクターの出現/消失、その他の視覚イベントにトランジションを適用する。

## 定義マネージャー

Argodeは、`.rgd`スクリプトファイル内で宣言されたアセットの解析と登録を処理するために、いくつかの専門的な定義マネージャーを採用しています。これらのマネージャーは、アセットが正しく認識され、プリロードされ（設定されている場合）、フレームワークですぐに利用できることを保証します。

*   **`AudioDefinitionManager`**: 背景音楽（BGM）と効果音（SFX）の定義を管理します。
*   **`CharacterDefinitionManager`**: 表情と関連リソースを含む、キャラクターの詳細な定義を管理します。

*   **`ImageDefinitionManager`**: 背景、キャラクタースプライト、その他の視覚アセットなどの画像の定義を管理します。
*   **`ShaderDefinitionManager`**: 視覚効果に使用されるカスタムシェーダーリソースの定義を管理します。
*   **`UISceneDefinitionManager`**: `ui`コマンドを使用して表示できるUIシーン（`.tscn`ファイル）の定義を管理します。

---

[ArgodeSystem APIについて学ぶ →](argode-system.md){ .md-button }
[ScriptPlayer APIについて学ぶ →](script-player.md){ .md-button }